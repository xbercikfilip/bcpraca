<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Galéria</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <style>
      .gallery {
        display: grid;
        grid-template-columns: repeat(10, 1fr);

        margin: auto;
      }

      .image {
        padding-top: 5px;
        margin: auto;
        height: 10em;
        width: 10rem;
      }

      .custom-slider {
        width: 20%;
        margin: auto;
        margin-top: 20px;
        text-align: center;
      }
      .modal-dialog {
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0;
        height: 100vh;
      }
      .modal-dialog .modal-body {
        padding: 0;
      }
      .modal-dialog .modal-body img {
        max-width: 50%;
        max-height: 50%;
        object-fit: contain;
      }
      .image-container {
        text-align: center;
        border: 1px solid #000000;
        margin: 5px;
        padding: 0px;
        position: relative;
        display: inline-block;
        height: 12rem; /* Adjusted height to fit content */
      }

      .image-container.liked {
        border-width: 3px; /* Increased border thickness for liked photos */
        padding: 3px; /* Adjusted padding to maintain layout */
      }
      .like-icon {
        position: absolute;
        bottom: 2px; /* Moved down */
        left: 50%;
        transform: translateX(-50%);
        cursor: pointer;
      }
      .like-icon.fas {
        color: red; /* Filled heart icon color */
      }

      #loadingOverlay {
        background-color: rgba(0, 0, 0, 0.5); /* Adjust opacity here */
      }
    </style>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
    />
  </head>
  <body>
    <h3 class="mt-2 h3 text-center">Galéria</h3>

    <div class="text-center container">
      <p>Označte aspoň 5 obrázkov a vyberte spôsob odporúčania</p>
    </div>
    <div id="gallery" class="mt-2 gallery"></div>

    <div id="loadingOverlay" class="modal-backdrop" style="display: none"></div>

    <div
      id="loadingModal"
      class="modal"
      tabindex="-1"
      role="dialog"
      style="display: none"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-body text-center">
            <h5>Spracovávam...</h5>
            <div class="progress">
              <div
                class="progress-bar progress-bar-striped progress-bar-animated"
                role="progressbar"
                aria-valuenow="100"
                aria-valuemin="0"
                aria-valuemax="100"
                style="width: 100%"
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="text-center my-4">
      <button id="executeButton" class="btn btn-success mt-3" disabled>
        Odporúčiť
      </button>
      <button id="resetButton" class="btn btn-danger mt-3">
        Resetovať dáta
      </button>
      <button id="selectAllButton" class="btn btn-primary mt-3">
        Select All Hearts
      </button>
      <div id="hiddenDiv" class="dropdown mt-3" hidden>
        <button
          class="btn btn-primary dropdown-toggle"
          type="button"
          id="dropdownMenuButton"
          data-toggle="dropdown"
          aria-haspopup="true"
          aria-expanded="false"
        >
          Content-based
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
          <a class="dropdown-item" href="#">Collaborative</a>
          <a class="dropdown-item" href="#">Content-based</a>
          <a class="dropdown-item" href="#">Hybrid</a>
          <a class="dropdown-item" href="#">Random</a>
          <a class="dropdown-item" href="#">Liked</a>
        </div>
      </div>
    </div>
    <div
      class="modal fade"
      id="imageModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="imageModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-body text-center">
            <img
              id="modalImage"
              src=""
              alt=""
              class="img-fluid"
              style="max-width: 100%; max-height: 100%"
            />
          </div>
        </div>
      </div>
    </div>
    <script>
      document
        .getElementById("selectAllButton")
        .addEventListener("click", function () {
          const likeIcons = document.querySelectorAll(".like-icon");

          likeIcons.forEach(function (icon) {
            icon.classList.add("fas");
            icon.classList.add("far");

            const imageContainer = icon.parentElement;
            imageContainer.classList.add("liked");
            var imageNumber = imageContainer
              .querySelector("img")
              .alt.split("/")[1];
            imageNumber = imageNumber.split(".")[0];

            likedImages.push(Number(imageNumber));

            if (likedImages.includes(Number(imageNumber))) {
              icon.classList.add("fas");
              icon.classList.add("far");
            }
            if (likedImages.length >= 5) {
              document.getElementById("executeButton").disabled = false;
            } else {
              document.getElementById("executeButton").disabled = true;
            }
          });
        });
      const deleteButton = document.getElementById("resetButton");

      deleteButton.addEventListener("click", function () {
        original_array = [];
        content_array = [];
        hybrid_array = [];
        collab_array = [];
        likedImages = [];
        mode = "rand";
        for (let i = rand_array.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [rand_array[i], rand_array[j]] = [rand_array[j], rand_array[i]];
        }
        updateGallery();
        document.getElementById("executeButton").disabled = true;
        document.getElementById("dropdownMenuButton").innerText =
          "Content-based";
      });
      const folder = "base/";
      var original_array = [];
      var content_array = [];
      var hybrid_array = [];
      var collab_array = [];
      var mode = "rand";
      var likedImages = [];

      document
        .getElementById("executeButton")
        .addEventListener("click", function () {
          document.getElementById("loadingModal").style.display = "block";
          document.getElementById("loadingOverlay").style.display = "block";
          executeFunction();
        });

      function executeFunction() {
        switch (mode) {
          case "content":
            if (content_array) break;
          case "original":
            break;
          case "hybrid":
            break;
          case "collab":
            break;

          case "rand":
            mode = "content";
            break;
        }
        const data = JSON.stringify({ likedImages: likedImages, mode: mode });
        fetch("/getImages", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: data,
        })
          .then((response) => response.json())
          .then((data) => {
            ///console.log(data);
            switch (mode) {
              case "content":
                content_array = data.images;
                break;
              case "hybrid":
                hybrid_array = data.images;
                break;
              case "collab":
                collab_array = data.images;
                break;
            }
            original_array = data.original;
            document.getElementById("hiddenDiv").removeAttribute("hidden");
            document.getElementById("loadingModal").style.display = "none";
            document.getElementById("loadingOverlay").style.display = "none";

            updateGallery();
          })
          .catch((error) => console.error("Error:", error));
      }
      document.querySelectorAll(".dropdown-item").forEach((item) => {
        item.addEventListener("click", function () {
          document.getElementById("dropdownMenuButton").innerText =
            this.innerText;
          switch (document.getElementById("dropdownMenuButton").innerText) {
            case "Content-based":
              mode = "content";
              break;
            case "Liked":
              mode = "original";
              break;
            case "Hybrid":
              mode = "hybrid";
              break;
            case "Collaborative":
              mode = "collab";
              break;
            default:
              mode = "rand";
              break;
          }
          updateGallery();
        });
      });

      var n = 516;
      var gallery = document.getElementById("gallery");

      let rand_array = [];
      for (let i = 0; i < n; i++) {
        rand_array.push(i);
      }

      for (let i = rand_array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [rand_array[i], rand_array[j]] = [rand_array[j], rand_array[i]];
      }

      function updateGallery() {
        var length = 100;
        ///console.log(mode);
        gallery.innerHTML = "";
        var array;
        switch (mode) {
          case "content":
            array = content_array;
            break;
          case "original":
            array = original_array;
            break;
          case "hybrid":
            array = hybrid_array;
            break;
          case "collab":
            array = collab_array;
            break;
          case "rand":
            array = rand_array;
            break;
        }
        if (mode != "rand") length = array.length;

        ///console.log(array);
        for (let i = 0; i < length; i++) {
          const container = document.createElement("div");
          container.classList.add("image-container");
          const image = document.createElement("img");

          image.src = folder + (array[i] + 1) + ".jpg";
          image.alt = "Image:" + folder + (array[i] + 1) + ".jpg";
          image.classList.add("image");

          const likeIcon = document.createElement("i");
          likeIcon.classList.add("like-icon", "far", "fa-heart");
          container.appendChild(image);
          container.appendChild(likeIcon);
          image.addEventListener("click", function () {
            document.getElementById("modalImage").src = this.src;
            $("#imageModal").modal("show");
          });
          gallery.appendChild(container);
        }
        const likeIcons = document.querySelectorAll(".like-icon");

        likeIcons.forEach(function (icon) {
          icon.addEventListener("click", function () {
            icon.classList.toggle("fas");
            icon.classList.toggle("far");

            const imageContainer = icon.parentElement;
            imageContainer.classList.toggle("liked");
            var imageNumber = imageContainer
              .querySelector("img")
              .alt.split("/")[1];
            imageNumber = imageNumber.split(".")[0];
            let index = Number(likedImages.indexOf(Number(imageNumber)));
            if (index != -1) {
              likedImages.splice(index, 1);
            } else {
              likedImages.push(Number(imageNumber));
            }
            ///console.log(likedImages);
            if (likedImages.length >= 5) {
              document.getElementById("executeButton").disabled = false;
            } else {
              document.getElementById("executeButton").disabled = true;
            }
          });
          if (
            likedImages.includes(
              Number(
                icon.parentElement
                  .querySelector("img")
                  .alt.split("/")[1]
                  .split(".")[0]
              )
            )
          ) {
            icon.classList.toggle("fas");
            icon.classList.toggle("far");
            icon.parentElement.classList.toggle("liked");
          }
        });
      }
      updateGallery();
    </script>
    <script
      src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
      integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
